import {ComponentBase} from '../<%= entity.getRelativeRoot() %>/base/componentBase';
import {<%= entity.name %>Contract} from '../../contracts/<%= entity.name %>';

<% if(entity.generalizationLinksTo) { %>
    import {<%= entity.generalizationLinksTo.name %>Base} from '../<%= entity.getRelativePath(entity.generalizationLinksTo) %>/components/generated/<%= entity.generalizationLinksTo.name %>.generated';
<% } %>

<% (entity.provided || []).forEach(function (value) { %>
<% if(value.name) { %>
  import {<%= value.name %>Contract} from '../<%= entity.getRelativePath(value.ref) %>/contracts/<%= value.name %>';

  <% (value.ref.attributes || []).filter(x => x.typeRef).forEach(function (attribute) { %>
    import {<%= attribute.typeRef.name %>Contract} from '../<%= entity.getRelativePath(attribute.typeRef) %>/contracts/<%= attribute.typeRef.name %>';
  <% }) %>
<%}})%>

<% (entity.required || []).forEach(function (value) { %>
  import {<%= value.name %>Contract} from '../<%= entity.getRelativePath(value.ref) %>/contracts/<%= value.name %>';
<%})%>

<% (entity.associationLinks || []).forEach(x => { %>
  import {<%= x.typeRef.name %>Contract} from '../<%= entity.getRelativePath(x.typeRef) %>/contracts/<%= x.typeRef.name %>';
<% }) %>

import {Promise} from 'es6-promise';

/**
* This file is auto-generated. Do not update it's content!
*/
export abstract class <%= entity.name %>Base extends <%= entity.generalizationLinksTo ? `${entity.generalizationLinksTo.name}Base` : 'ComponentBase' %> implements <%= entity.name %>Contract <% if ((entity.provided || []).length) { %>, <%}%><%= (entity.provided || []).map(function(x) { return x.name + 'Contract' }).join(', ') %> {

  <% (entity.attributes || []).forEach(function (attr) { %>
  /**
  * <%= attr.name %> property
  */
  <%= attr.name %>: <%= attr.typeRef ? attr.typeRef.name + 'Contract' : attr.type %> = <%- attr.typeDefaultValue %>;
  <% }) %>

  <% (entity.associationLinks || []).forEach(x => { %>
  /**
  * <%= x.typeRef.name %> associated reference.
  */
  <% if(x.multiplicity === '1' || x.multiplicity === '0..1') { %>
    <%= x.typeRef.name %>Ref: <%= x.typeRef.name %>Contract | null = null;
  <%} else {%>
    <%= x.typeRef.name %>RefList: <%= x.typeRef.name %>Contract[] = [];
  <% }}) %>

  constructor(
  <% (entity.required || []).map(function (value, i, list) { %>
    protected <%= value.ref.name %>: <%= value.ref.name %>Contract <% if(i < list.length) { %>,<% } %>
  <% }) %>) {
    super();
  }

  <% if(entity.fragments.find(x => x.interactionOperator === 'loop')) { %>
  /**
  * Loop condition.
  */
  get loopCondition(): boolean {
    return true;
  }

  /**
  * Get loop delay in ms.
  */
  get loopDelay(): number {
    return 30 * 1000; //30 sec
  }
  <% } %>

  <% (entity.operations || []).forEach(function (operation) { %>
  /**
  * <%= operation.name %> description.
  */
  <%= operation.name %>(state: any): Promise<any> {
    return new Promise((resolve, reject) => {
      this.notifyComplete('<%= entity.name %>::<%= operation.name %>', state.start);
      resolve(state);
    });
  }
  <% }) %>

  <% (entity.provided || []).forEach(function (value) { %>
    //#region <%= value.name %>Contract implementation

    <% (value.ref.attributes || []).forEach(function (attribute) { %>
    /**
    * <%= attribute.name %> description.
    */
    get <%= attribute.name %>(): <%= attribute.typeRef ? attribute.typeRef.name + 'Contract' : (attribute.type || 'any') %> {
      throw new Error('Not implemented');
    }
    <% }) %>


    <% (value.ref.operations || []).forEach(function (operation) { %>
    /**
    * <%= operation.name %> description.
    */
    <%= operation.name %>(state: any): Promise<any> {
      return new Promise((resolve, reject) => {
        reject(new Error('Not implemented'));
      });
    }
    <% }) %>

    //#endregion
  <%})%>
}
