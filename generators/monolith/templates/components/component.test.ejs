import {<%= entity.namePascal %>Contract} from "../contracts/<%= entity.name %>";
import {FlowStateType} from "<%= entity.getRelativeRoot() %>/types/flowStateType";

import {DIContainer} from "../<%= entity.getRelativeRoot() %>/inversify.config";
import {DITypes} from "<%= entity.getRelativeRoot() %>/types/diTypes";
<%
    const imports = (entity.operations || []).reduce((memo, operation) => {
        operation.inputParameters.filter(x => x.typeRef).forEach(x => memo[entity.getRelativePath(x.typeRef) + '/components/' + x.typeRef.name] = x.typeRef);
        operation.returnParameter.typeRef && (memo[entity.getRelativePath(operation.returnParameter.typeRef) + '/components/' + operation.returnParameter.typeRef.name] = operation.returnParameter.typeRef);

        return memo;
    }, {});
%>
<% Object.keys(imports).forEach(key => {%>
import {<%= imports[key].namePascal %>} from '<%= key %>';<%})%>

describe('<%= entity.name %> specification check', () => {
    const instance = DIContainer.get<<%= entity.namePascal %>Contract>(DITypes.<%= entity.namePascal %>Contract);
    const state: FlowStateType = { start: new Date() };
<% (entity.operations || []).forEach(operation => { %>
    it('verify "<%= operation.name %>"', async () => {<% operation.inputParameters.forEach(x => { %>
        const <%= x.name %> = <%= x.isArray ? '[' : '' %><%- x.typeRef ? `new ${x.typeRef.namePascal}()` : x.typeDefaultValue %><%= x.isArray ? ']' : '' %>;<% }) %>
        const expected <% if(operation.isReturnArray) { %>: <%= operation.returnParameter.typeRef ? `${operation.returnParameter.typeRef.namePascal}` : operation.returnParameter.type %>[]<% } %> = <%= operation.isReturnArray ? '[]' : operation.returnParameter.typeRef ? `new ${operation.returnParameter.typeRef.namePascal}()` : operation.returnParameter.typeDefaultValue %>;
        const actual = await instance.<%= operation.name %>({...state, ...{<%= operation.inputParameters.map(x => `${x.name} : ${x.name}` )%>}});

        expect(actual.returns).toEqual(expected);
    });
<% }) %>
});
