<%
    const refs = {};

    components.forEach(x => {
        refs[`./design/${x.entity.pathFromRoot}/contracts/${x.entity.name}`] = `${x.entity.namePascal}Contract`;
        refs[`./design/${x.entity.pathFromRoot}/components/${x.entity.name}`] = x.entity.namePascal;

        x.entity.provided.forEach(y => {
            refs[`./design/${y.typeRef.pathFromRoot}/contracts/${y.typeRef.name}`] = `${y.typeRef.namePascal}Contract`;
        });
    });
%>

import { Container } from "inversify";
import { DITypes } from "./design/types/diTypes";
import { DbManagerCommon } from "./design/common/dbManagerCommon";
import {Context} from "inversify/dts/planning/context";

<% Object.keys(refs).forEach(x => { %>
import {<%= refs[x] %>} from '<%= x %>';
<% }) %>

const DIContainer = new Container();
const env = process.env;

DIContainer.bind<() => Promise<DbManagerCommon>>(DITypes.ICommonDbManagerContract)
    .toDynamicValue((context: Context) => () => DbManagerCommon.getInstance());

<% components.forEach(x => { %>
DIContainer.bind<<%= x.entity.namePascal %>Contract>(DITypes.<%= x.entity.namePascal %>Contract).to(<%= x.entity.namePascal %>);
<% x.entity.provided.forEach(y => { %>
DIContainer.bind<<%= y.namePascal %>Contract>(DITypes.<%= y.namePascal %>Contract).to(<%= x.entity.namePascal %>);<% })}) %>

export { DIContainer };
