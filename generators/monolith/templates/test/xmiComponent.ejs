const chalk = require("chalk");

import "reflect-metadata";
import {<%= entity.name %>} from '../process/<%= entity.name %>';

<%
    var imports = [];

    (entity.lifelines || []).forEach(function (lifeline) {
        imports.push(lifeline.ref);

        (lifeline.ref.required || []).map(x => factory.resolveDependency(x.ref ? x.ref.name : x.name)).forEach(value => {
            imports.push(value);
        })
    });
%>

<% imports.filter((x, i, arr) => arr.indexOf(x) === i).forEach(x => { %>
    import {<%= x.name %>} from '<%= entity.getRelativePath(x) %>/components/<%= x.name %>';
<% }) %>

const flow = new <%= entity.name %>(<% (entity.lifelines || []).forEach(function (lifeline) { %>
    new <%= lifeline.name %>(
        <% (lifeline.ref.required || []).map(function (value) { %>
            new <%= factory.resolveDependency(value.ref ? value.ref.name : value.name).name %>(),
        <% }) %>
    ),
<% }) %>);

console.log('Flow execution:');
flow.run({}).then(ret => {
    console.log('--> Completed');
    process.exit(0);
});
